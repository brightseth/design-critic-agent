<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Nina API</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            background: #333;
            color: #fff;
            border: 1px solid #666;
        }
        button:hover {
            background: #444;
        }
        #status {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            background: #111;
        }
        #result {
            margin: 20px 0;
            padding: 15px;
            background: #111;
            border: 1px solid #333;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }
        .error {
            color: #f44336;
        }
        .success {
            color: #4CAF50;
        }
        .info {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>Nina API Test</h1>
    
    <button onclick="testWithSmallImage()">Test with Small Image</button>
    <button onclick="testWithRealImage()">Test with Real Image</button>
    <button onclick="testDirect()">Test Direct API</button>
    
    <div id="status"></div>
    <div id="result"></div>

    <script>
        const statusEl = document.getElementById('status');
        const resultEl = document.getElementById('result');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            statusEl.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            console.log(`[${type}] ${message}`);
        }
        
        async function testWithSmallImage() {
            statusEl.innerHTML = '';
            resultEl.innerHTML = '';
            
            log('Creating small test image...');
            
            // Create a 100x100 test image
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            
            // Draw something interesting
            const gradient = ctx.createLinearGradient(0, 0, 100, 100);
            gradient.addColorStop(0, '#ff0000');
            gradient.addColorStop(0.5, '#00ff00');
            gradient.addColorStop(1, '#0000ff');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 100, 100);
            
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText('TEST', 25, 55);
            
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            const base64 = imageData.split(',')[1];
            
            log(`Image created, size: ${base64.length} bytes`);
            log('Sending to API...');
            
            try {
                const startTime = Date.now();
                
                const response = await fetch('https://design-critic-agent.vercel.app/api/nina-curator-v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        imageData: base64,
                        mode: 'single'
                    })
                });
                
                const duration = Date.now() - startTime;
                log(`Response received in ${duration}ms`, response.ok ? 'success' : 'error');
                log(`Status: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                
                if (response.ok) {
                    log('Success! Evaluation received', 'success');
                    resultEl.innerHTML = JSON.stringify(data, null, 2);
                } else {
                    log('API Error', 'error');
                    resultEl.innerHTML = JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                resultEl.innerHTML = error.stack;
            }
        }
        
        async function testWithRealImage() {
            statusEl.innerHTML = '';
            resultEl.innerHTML = '';
            
            log('Creating realistic art image...');
            
            // Create a larger, more realistic image
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Create abstract art
            for (let i = 0; i < 50; i++) {
                ctx.fillStyle = `hsla(${Math.random() * 360}, 70%, 50%, 0.3)`;
                ctx.beginPath();
                ctx.arc(
                    Math.random() * 800,
                    Math.random() * 600,
                    Math.random() * 100 + 20,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
            
            const imageData = canvas.toDataURL('image/jpeg', 0.7);
            const base64 = imageData.split(',')[1];
            
            log(`Image created, size: ${base64.length} bytes`);
            log('Sending to API...');
            
            try {
                const startTime = Date.now();
                
                const response = await fetch('https://design-critic-agent.vercel.app/api/nina-curator-v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        imageData: base64,
                        mode: 'single'
                    })
                });
                
                const duration = Date.now() - startTime;
                log(`Response received in ${duration}ms`, response.ok ? 'success' : 'error');
                log(`Status: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                
                if (response.ok) {
                    log('Success! Evaluation received', 'success');
                    resultEl.innerHTML = JSON.stringify(data, null, 2);
                } else {
                    log('API Error', 'error');
                    resultEl.innerHTML = JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                resultEl.innerHTML = error.stack;
            }
        }
        
        async function testDirect() {
            statusEl.innerHTML = '';
            resultEl.innerHTML = '';
            
            log('Testing direct API call...');
            
            try {
                // First test if API is accessible
                const testResponse = await fetch('https://design-critic-agent.vercel.app/api/test-env');
                const testData = await testResponse.json();
                log(`API accessible: ${testResponse.ok}`, testResponse.ok ? 'success' : 'error');
                log(`Has API Key: ${testData.hasApiKey}`);
                
                // Now test the actual endpoint
                log('Testing nina-curator-v2 endpoint...');
                
                const response = await fetch('https://design-critic-agent.vercel.app/api/nina-curator-v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        imageData: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',
                        mode: 'single'
                    })
                });
                
                log(`Response status: ${response.status}`);
                const data = await response.json();
                resultEl.innerHTML = JSON.stringify(data, null, 2);
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                resultEl.innerHTML = error.stack;
            }
        }
    </script>
</body>
</html>